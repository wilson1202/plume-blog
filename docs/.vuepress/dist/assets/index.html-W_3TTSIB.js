import{_ as i,c as e,d as a,o as t}from"./app-v0hYxepB.js";const h={};function n(l,s){return t(),e("div",null,s[0]||(s[0]=[a(`<h2 id="pci-è®¾å¤‡ç›´é€š" tabindex="-1"><a class="header-anchor" href="#pci-è®¾å¤‡ç›´é€š"><span>PCI è®¾å¤‡ç›´é€š</span></a></h2><p><strong>VMware ESXi</strong> ç¯å¢ƒä¸‹çš„ä¸€ç§åº•å±‚ç›´é€šæœºåˆ¶ï¼Œé€šè¿‡æ‰‹åŠ¨ç¼–è¾‘ <code>passthru.map</code> æ–‡ä»¶æ¥å®ç° PCI è®¾å¤‡çš„ç›´é€šæ§åˆ¶ã€‚è¿™ä¸ªæ–¹æ¡ˆé€‚ç”¨äº<strong>å°†ç‰©ç†æ§åˆ¶å™¨è®¾å¤‡ï¼ˆå¦‚ SATA æ§åˆ¶å™¨ï¼‰Passthrough ç»™è™šæ‹Ÿæœº</strong>ï¼Œå®ƒæ˜¯ <strong>PCI Passthroughï¼ˆè®¾å¤‡ç›´é€šï¼‰</strong> çš„ä¸€ç§æ–¹å¼ã€‚</p><hr><h3 id="ğŸ”-è¯¦ç»†è§£é‡Š" tabindex="-1"><a class="header-anchor" href="#ğŸ”-è¯¦ç»†è§£é‡Š"><span>ğŸ” è¯¦ç»†è§£é‡Šï¼š</span></a></h3><h4 id="ä½ æ‰§è¡Œçš„å‘½ä»¤" tabindex="-1"><a class="header-anchor" href="#ä½ æ‰§è¡Œçš„å‘½ä»¤"><span>ä½ æ‰§è¡Œçš„å‘½ä»¤ï¼š</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">lspci</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -v</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> |</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> grep</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">Class 0106</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -B</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 1</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¾“å‡ºï¼š</p><div class="language-ini line-numbers-mode" data-highlighter="shiki" data-ext="ini" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-ini"><span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">0000:00:17.0 Mass storage controller SATA controller: Intel Corporation Comet Lake SATA AHCI Controller </span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">         Class 0106: 8086:06d2</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>è¯´æ˜ä½ çš„ ESXi ä¸»æœºä¸Šæœ‰ä¸€å— <strong>SATA AHCI æ§åˆ¶å™¨ï¼ˆç±»ä»£ç  0106ï¼‰</strong>ï¼Œå…¶ PCI ID æ˜¯ <code>8086:06d2</code>ã€‚</p><hr><h4 id="ä¿®æ”¹-passthru-map-æ–‡ä»¶" tabindex="-1"><a class="header-anchor" href="#ä¿®æ”¹-passthru-map-æ–‡ä»¶"><span>ä¿®æ”¹ <code>passthru.map</code> æ–‡ä»¶ï¼š</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">vi</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /etc/vmware/passthru.map</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># æ·»åŠ ä»¥ä¸‹å†…å®¹</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">8086</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">   06d2</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">    d3d0</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">    false</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å­—æ®µå«ä¹‰å¦‚ä¸‹ï¼š</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>VendorID  DeviceID  SubsystemID  passthru</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li><code>8086</code>ï¼šIntel çš„å‚å•† ID</li><li><code>06d2</code>ï¼šè®¾å¤‡ ID</li><li><code>d3d0</code>ï¼šå­ç³»ç»Ÿ IDï¼ˆå¯ä»»æ„å¡«ï¼Œå¸¸è§å†™æ³•ï¼‰</li><li><code>false</code>ï¼šè¡¨ç¤ºä¸å¯ç”¨ MSI/MSI-Xï¼Œé€‚ç”¨äºéƒ¨åˆ†ç›´é€šè®¾å¤‡éœ€è¦ç¦ç”¨ä¸­æ–­æ˜ å°„</li></ul><hr><h3 id="âœ…-è¿™æ˜¯å“ªç§ç›´é€šæ–¹æ¡ˆ" tabindex="-1"><a class="header-anchor" href="#âœ…-è¿™æ˜¯å“ªç§ç›´é€šæ–¹æ¡ˆ"><span>âœ… è¿™æ˜¯å“ªç§ç›´é€šæ–¹æ¡ˆï¼Ÿ</span></a></h3><p>è¿™æ˜¯ <strong>VMware ESXi çš„ PCI Device Passthrough</strong>ï¼ˆä¹Ÿç§° DirectPath I/Oï¼‰ï¼š</p><blockquote><p>å…è®¸å°†ç‰©ç†ä¸»æœºçš„ PCI è®¾å¤‡ï¼ˆå¦‚ç½‘å¡ã€SATA æ§åˆ¶å™¨ã€NVMe æ§åˆ¶å™¨ç­‰ï¼‰<strong>ç›´æ¥åˆ†é…ç»™è™šæ‹Ÿæœºä½¿ç”¨</strong>ï¼Œç»•è¿‡ hypervisor çš„æŠ½è±¡å±‚ï¼Œä»è€Œæå‡æ€§èƒ½æˆ–å®ç°ç›´æ¥ç¡¬ä»¶è®¿é—®ã€‚</p></blockquote><hr><h3 id="âš ï¸-æ³¨æ„äº‹é¡¹" tabindex="-1"><a class="header-anchor" href="#âš ï¸-æ³¨æ„äº‹é¡¹"><span>âš ï¸ æ³¨æ„äº‹é¡¹ï¼š</span></a></h3><ol><li>ä½¿ç”¨è¿™ç§æ–¹å¼ç›´é€š SATA æ§åˆ¶å™¨åï¼Œè¯¥æ§åˆ¶å™¨ä¸‹æŒ‚è½½çš„ç‰©ç†ç¡¬ç›˜å°†<strong>ä¸å†è¢« ESXi è¯†åˆ«</strong>ï¼Œè€Œåªèƒ½ç”±ç›´é€šåˆ°çš„è™šæ‹Ÿæœºä½¿ç”¨ã€‚</li><li>æœ‰äº›ä¸»æ¿çš„ SATA æ§åˆ¶å™¨ä¸æ”¯æŒ IOMMU éš”ç¦»ï¼Œå¯èƒ½å¯¼è‡´ passthrough å¤±è´¥ã€‚</li><li>é…ç½®å®Œæˆåï¼Œéœ€é‡å¯ ESXi å¹¶åœ¨è™šæ‹Ÿæœºè®¾ç½®ä¸­æ·»åŠ å¯¹åº”çš„ PCI è®¾å¤‡ã€‚</li></ol><hr><h3 id="ğŸ§©-é™„åŠ å»ºè®®" tabindex="-1"><a class="header-anchor" href="#ğŸ§©-é™„åŠ å»ºè®®"><span>ğŸ§© é™„åŠ å»ºè®®ï¼š</span></a></h3><p>è¦æ£€æŸ¥ IOMMU å’Œç›´é€šå¯ç”¨çŠ¶æ€ï¼Œå¯ä»¥åœ¨ ESXi Shell ä¸­æ‰§è¡Œï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">vmkchdev</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -l</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> |</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> grep</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 06d2</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¦å¯ç”¨ passthroughï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">vmkchdev</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -v</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 0000:00:17.0</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -p</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><hr><p>å¦‚ä½ å¸Œæœ›è¿›ä¸€æ­¥ç›´é€šç¡¬ç›˜æœ¬èº«è€Œéæ§åˆ¶å™¨ï¼Œä¹Ÿå¯ä»¥è€ƒè™‘ä½¿ç”¨ <strong>RDMï¼ˆRaw Device Mappingï¼‰</strong>ï¼Œè¿™ä¸¤è€…ç”¨é€”ç•¥æœ‰ä¸åŒï¼š</p><table><thead><tr><th>æ–¹æ¡ˆ</th><th>ç”¨é€”</th><th>é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td>PCI Passthrough</td><td>ç›´é€šæ•´ä¸ª SATA/NVMe æ§åˆ¶å™¨</td><td>é«˜æ€§èƒ½ã€ZFSã€è½¯ RAID åœºæ™¯</td></tr><tr><td>RDM</td><td>ç›´é€šå•å—ç‰©ç†ç¡¬ç›˜</td><td>ç²¾ç»†æ§åˆ¶å•å—ç£ç›˜æ˜ å°„</td></tr></tbody></table><p>å¦‚æœä½ å‘Šè¯‰æˆ‘ä½ æƒ³ç”¨å®ƒæ¥è¿è¡Œä»€ä¹ˆç³»ç»Ÿï¼ˆå¦‚ TrueNASã€Unraidã€ç›´é€šç»™ Linux åš ZFS ç­‰ï¼‰ï¼Œæˆ‘å¯ä»¥è¿›ä¸€æ­¥å¸®ä½ åˆ¤æ–­æ˜¯å¦é€‚åˆè¿™ç§ passthroughã€‚</p><h2 id="rdm-åŸå§‹è®¾å¤‡æ˜ å°„" tabindex="-1"><a class="header-anchor" href="#rdm-åŸå§‹è®¾å¤‡æ˜ å°„"><span>RDM åŸå§‹è®¾å¤‡æ˜ å°„</span></a></h2><ul><li><p>åˆ›å»ºä¸€ä¸ª <strong>.vmdk æ–‡ä»¶æŒ‡å‘ç‰©ç†ç¡¬ç›˜</strong>ï¼ˆESXi ä¸ç›´é€šæ§åˆ¶å™¨ï¼Œä»…ä¼ é€’ç£ç›˜è·¯å¾„ï¼‰ã€‚</p></li><li><p>é€šè¿‡ <code>vmkfstools -z</code> å‘½ä»¤å»ºç«‹ RDM æ˜ å°„ï¼Œå¦‚ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">vmkfstools</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -z</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /vmfs/devices/disks/t10.ATA_____Disk123456</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /vmfs/volumes/datastore1/vmname/disk1.vmdk</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li></ul>`,34)]))}const d=i(h,[["render",n]]),p=JSON.parse('{"path":"/article/uvr6yekg/","title":"ESXi ç›´é€š SATA æ§åˆ¶å™¨","lang":"zh-CN","frontmatter":{"title":"ESXi ç›´é€š SATA æ§åˆ¶å™¨","createTime":"2025/05/28 22:20:25","permalink":"/article/uvr6yekg/","tags":["pci","esxi","vm"],"description":"PCI è®¾å¤‡ç›´é€š VMware ESXi ç¯å¢ƒä¸‹çš„ä¸€ç§åº•å±‚ç›´é€šæœºåˆ¶ï¼Œé€šè¿‡æ‰‹åŠ¨ç¼–è¾‘ passthru.map æ–‡ä»¶æ¥å®ç° PCI è®¾å¤‡çš„ç›´é€šæ§åˆ¶ã€‚è¿™ä¸ªæ–¹æ¡ˆé€‚ç”¨äºå°†ç‰©ç†æ§åˆ¶å™¨è®¾å¤‡ï¼ˆå¦‚ SATA æ§åˆ¶å™¨ï¼‰Passthrough ç»™è™šæ‹Ÿæœºï¼Œå®ƒæ˜¯ PCI Passthroughï¼ˆè®¾å¤‡ç›´é€šï¼‰ çš„ä¸€ç§æ–¹å¼ã€‚ ğŸ” è¯¦ç»†è§£é‡Šï¼š ä½ æ‰§è¡Œçš„å‘½ä»¤ï¼š è¾“å‡ºï¼š è¯´æ˜ä½ çš„ ESX...","head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"ESXi ç›´é€š SATA æ§åˆ¶å™¨\\",\\"image\\":[\\"\\"],\\"dateModified\\":null,\\"author\\":[]}"],["meta",{"property":"og:url","content":"https://powersen.cn/article/uvr6yekg/"}],["meta",{"property":"og:site_name","content":"Powersen"}],["meta",{"property":"og:title","content":"ESXi ç›´é€š SATA æ§åˆ¶å™¨"}],["meta",{"property":"og:description","content":"PCI è®¾å¤‡ç›´é€š VMware ESXi ç¯å¢ƒä¸‹çš„ä¸€ç§åº•å±‚ç›´é€šæœºåˆ¶ï¼Œé€šè¿‡æ‰‹åŠ¨ç¼–è¾‘ passthru.map æ–‡ä»¶æ¥å®ç° PCI è®¾å¤‡çš„ç›´é€šæ§åˆ¶ã€‚è¿™ä¸ªæ–¹æ¡ˆé€‚ç”¨äºå°†ç‰©ç†æ§åˆ¶å™¨è®¾å¤‡ï¼ˆå¦‚ SATA æ§åˆ¶å™¨ï¼‰Passthrough ç»™è™šæ‹Ÿæœºï¼Œå®ƒæ˜¯ PCI Passthroughï¼ˆè®¾å¤‡ç›´é€šï¼‰ çš„ä¸€ç§æ–¹å¼ã€‚ ğŸ” è¯¦ç»†è§£é‡Šï¼š ä½ æ‰§è¡Œçš„å‘½ä»¤ï¼š è¾“å‡ºï¼š è¯´æ˜ä½ çš„ ESX..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"article:tag","content":"vm"}],["meta",{"property":"article:tag","content":"esxi"}],["meta",{"property":"article:tag","content":"pci"}]]},"readingTime":{"minutes":2.1,"words":629},"git":{"createdTime":1750126639000},"autoDesc":true,"filePathRelative":"2.ç³»ç»Ÿ/3.ESXi/b-system-esxi-2.passthrough-sata-controller.md","headers":[],"categoryList":[{"id":"b3a06a","sort":2,"name":"ç³»ç»Ÿ"},{"id":"d8fa68","sort":3,"name":"ESXi"}]}');export{d as comp,p as data};

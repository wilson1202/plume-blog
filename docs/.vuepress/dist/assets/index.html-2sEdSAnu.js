import{_ as s,c as e,d as a,o as l}from"./app-B19s9SdH.js";const n={};function t(d,i){return l(),e("div",null,[...i[0]||(i[0]=[a(`<h2 id="一、下载-debian-cloud-image" tabindex="-1"><a class="header-anchor" href="#一、下载-debian-cloud-image"><span>一、下载 Debian Cloud Image</span></a></h2><ul><li><p>官方地址：<a href="https://cloud.debian.org/images/cloud/" target="_blank" rel="noopener noreferrer">https://cloud.debian.org/images/cloud/</a></p></li><li><p>下载后假设文件名为：<code>debian.qcow2</code></p></li></ul><h2 id="二、转换为-esxi-可用-vmdk" tabindex="-1"><a class="header-anchor" href="#二、转换为-esxi-可用-vmdk"><span>二、转换为 ESXi 可用 VMDK</span></a></h2><ul><li><p>先转换成 raw（如果原始是 qcow2）：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">qemu-img</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> convert</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -f</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> qcow2</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -O</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> raw</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> debian.qcow2</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> debian.raw</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p>然后转换成 ESXi 可识别 VMDK：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">qemu-img</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> convert</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -f</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> raw</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -O</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> vmdk</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> \\</span></span>
<span class="line"><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">  -o</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> adapter_type=lsilogic,subformat=monolithicFlat</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> \\</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">  debian.raw</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> debian.vmdk</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><div class="hint-container note"><p class="hint-container-title">注</p><ul><li><code>adapter_type=lsilogic</code> → SCSI 控制器，ESXi 支持</li><li><code>subformat=monolithicFlat</code> → ESXi 可以直接开机</li></ul></div><h2 id="三、创建-cloud-init-配置" tabindex="-1"><a class="header-anchor" href="#三、创建-cloud-init-配置"><span>三、创建 cloud-init 配置</span></a></h2><ul><li><strong>user-data</strong>（在 <code>/root/user-data</code>）：</li></ul><div class="language-yaml line-numbers-mode" data-highlighter="shiki" data-ext="yaml" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-yaml"><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#cloud-config</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">users</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">  -</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;"> name</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> debian</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">    sudo</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ALL=(ALL) NOPASSWD:ALL</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">    shell</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /bin/bash</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">    lock_passwd</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> false</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">chpasswd</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">  list</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> |</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">    debian:123456</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">  expire</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> false</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>meta-data</strong>（在 <code>/root/meta-data</code>）：</li></ul><div class="language-text line-numbers-mode" data-highlighter="shiki" data-ext="text" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-text"><span class="line"><span>instance-id: debian-01</span></span>
<span class="line"><span>local-hostname: debian</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="四、生成-seed-iso" tabindex="-1"><a class="header-anchor" href="#四、生成-seed-iso"><span>四、生成 seed.iso</span></a></h2><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">cloud-localds</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /root/seed.iso</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /root/user-data</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /root/meta-data</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><div class="hint-container info"><p class="hint-container-title">生成成功后，得到 <code>/root/seed.iso</code>，这个 ISO 用于 cloud-init 初始化用户</p></div><h2 id="五、在-esxi-创建虚拟机" tabindex="-1"><a class="header-anchor" href="#五、在-esxi-创建虚拟机"><span>五、在 ESXi 创建虚拟机</span></a></h2><div class="vp-steps"><ol><li>创建新 VM： <ul><li>类型：Linux → Debian 13 / 64-bit</li><li>SCSI 控制器：LSI Logic SAS</li></ul></li><li>上传 <code>debian.vmdk</code> 到 datastore</li><li>上传 <code>seed.iso</code> 到 datastore</li><li>在 VM 设置中： <ul><li>把 <code>debian.vmdk</code> 作为主硬盘</li><li>把 <code>seed.iso</code> 挂载到 CD-ROM</li></ul></li><li>确保 CD-ROM 设置为 <strong>开机启动</strong>（optional，但第一次启动可用）</li></ol></div><h2 id="六、启动虚拟机" tabindex="-1"><a class="header-anchor" href="#六、启动虚拟机"><span>六、启动虚拟机</span></a></h2><ul><li><p>首次启动：</p><ul><li>cloud-init 会读取 <code>seed.iso</code></li><li>自动创建用户 <code>debian</code>，密码 <code>123456</code></li></ul></li><li><p>登录：</p><div class="language-text line-numbers-mode" data-highlighter="shiki" data-ext="text" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-text"><span class="line"><span>用户名：debian</span></span>
<span class="line"><span>密码：123456</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>验证 sudo/root：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">sudo</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -i</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li></ul><h2 id="七、清理-可选" tabindex="-1"><a class="header-anchor" href="#七、清理-可选"><span>七、清理（可选）</span></a></h2><ul><li>登录后可卸载 seed.iso</li><li>删除 <code>/root/seed.iso</code>，避免重复 cloud-init 修改</li><li>修改用户密码或创建更多用户</li></ul><div class="hint-container important"><p class="hint-container-title">注意事项</p><ol><li><strong>不要直接尝试 root 登录</strong>，Cloud Image 默认锁定 root</li><li><strong>raw → VMDK 转换必须用 monolithicFlat</strong></li><li><strong>streamOptimized VMDK 只能用于 OVF/OVA 导入</strong>，不能直接开机</li></ol></div><h2 id="八、开启-ssh-登录" tabindex="-1"><a class="header-anchor" href="#八、开启-ssh-登录"><span>八、开启 SSH 登录</span></a></h2><ol><li><p><strong>备份原配置文件</strong>（避免操作失误）：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>sudo cp /etc/ssh/sshd_config /etc/ssh/sshd_config.bak</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p><strong>编辑 SSH 配置文件</strong>：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">sudo</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> nano</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /etc/ssh/sshd_config</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p><strong>找到并修改以下参数</strong>：</p><ul><li><p>将 <code>PermitRootLogin</code> 的值改为 <code>yes</code>（如果行首有 <code>#</code> 注释符，需删除注释）：</p><div class="language-ini line-numbers-mode" data-highlighter="shiki" data-ext="ini" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-ini"><span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">PermitRootLogin </span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;" class="highlighted-word">yes</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    </span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p>确保允许密码认证（如果禁用密码需同时修改）：</p><div class="language-ini line-numbers-mode" data-highlighter="shiki" data-ext="ini" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-ini"><span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">PasswordAuthentication </span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;" class="highlighted-word">yes</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    </span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li></ul></li><li><p><strong>保存并退出编辑器</strong>（Nano 快捷键：<code>Ctrl+O</code> 保存，<code>Ctrl+X</code> 退出）。</p></li><li><p><strong>重启 SSH 服务</strong>:</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">sudo</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> systemctl</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> restart</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ssh</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li></ol><h2 id="九、其他配置" tabindex="-1"><a class="header-anchor" href="#九、其他配置"><span>九、其他配置</span></a></h2><ol><li><p>给root用户设定密码</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">sudo</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> passwd</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> root</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p>查看当前网络接口</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">ip</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> a</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li></ol>`,24)])])}const r=s(n,[["render",t]]),k=JSON.parse('{"path":"/article/gno53kkv/","title":"ESXi 部署 debian cloud 镜像","lang":"zh-CN","frontmatter":{"title":"ESXi 部署 debian cloud 镜像","createTime":"2025/11/19 21:27:25","permalink":"/article/gno53kkv/","tags":["esxi","vm","cloud"],"description":"一、下载 Debian Cloud Image 官方地址：https://cloud.debian.org/images/cloud/ 下载后假设文件名为：debian.qcow2 二、转换为 ESXi 可用 VMDK 先转换成 raw（如果原始是 qcow2）： 然后转换成 ESXi 可识别 VMDK： 注 adapter_type=lsilogic...","head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"ESXi 部署 debian cloud 镜像\\",\\"image\\":[\\"\\"],\\"dateModified\\":null,\\"author\\":[]}"],["meta",{"property":"og:url","content":"https://powersen.cn/article/gno53kkv/"}],["meta",{"property":"og:site_name","content":"Powersen"}],["meta",{"property":"og:title","content":"ESXi 部署 debian cloud 镜像"}],["meta",{"property":"og:description","content":"一、下载 Debian Cloud Image 官方地址：https://cloud.debian.org/images/cloud/ 下载后假设文件名为：debian.qcow2 二、转换为 ESXi 可用 VMDK 先转换成 raw（如果原始是 qcow2）： 然后转换成 ESXi 可识别 VMDK： 注 adapter_type=lsilogic..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"article:tag","content":"cloud"}],["meta",{"property":"article:tag","content":"vm"}],["meta",{"property":"article:tag","content":"esxi"}]]},"readingTime":{"minutes":1.87,"words":561},"git":{},"autoDesc":true,"filePathRelative":"blog/2.系统/3.ESXi/b-system-esxi-3.deploying-the-debian-cloud-image.md","headers":[],"categoryList":[{"id":"b3a06a","sort":2,"name":"系统"},{"id":"d8fa68","sort":3,"name":"ESXi"}]}');export{r as comp,k as data};

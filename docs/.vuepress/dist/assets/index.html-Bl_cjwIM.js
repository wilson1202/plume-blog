import{_ as t,c as d,d as e,a as i,b as l,e as a,r,o as h}from"./app-Bymrm4IP.js";const p={},k={class:"hint-container details"},c={class:"code-block-title","data-title":"resolved.conf"},o={class:"code-block-title-bar"},g={class:"title"},u={class:"hint-container note"},m={class:"code-block-title","data-title":"smartdns.conf"},v={class:"code-block-title-bar"},b={class:"title"};function y(f,s){const n=r("VPIcon");return h(),d("div",null,[s[10]||(s[10]=e(`<h2 id="linux安装" tabindex="-1"><a class="header-anchor" href="#linux安装"><span>Linux安装</span></a></h2><ul><li>下载配套安装包，并上传到 Linux 系统中, 标准 Linux 系统（X86 / X86_64）请执行如下命令安装：</li></ul><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">tar</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> zxf</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> smartdns.1.yyyy.MM.dd-REL.x86_64-linux-all.tar.gz</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">cd</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> smartdns</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">chmod</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> +x</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ./install</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">./install</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -i</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>树莓派或其他 Debian 系系统（ARM / ARM64）请执行如下命令安装：</li></ul><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">dpkg</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -i</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> smartdns.1.yyyy.MM.dd-REL.arm-debian-all.deb</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><div class="hint-container caution"><p class="hint-container-title">关注 <strong>Ubuntu</strong> 系统 <strong>53</strong> 端口占用问题</p><ol><li>ubuntu系统下，<code>systemd-resolved</code>会占用 <code>TCP53</code> 和 <code>UDP53</code> 端口, 你需要手动解决端口占用问题或者修改 SmartDNS 监听端口。</li><li>日志文件在 <code class="filepath">/var/log/smartdns/smartdns.log</code></li></ol></div>`,6)),i("details",k,[s[5]||(s[5]=e('<summary>解决 53 端口占用问题</summary><p>查看端口占用情况</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">lsof</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -i:53</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>方案一：关闭 DNS 存根监听器，使其不再监听 53 端口</strong></p>',4)),i("ol",null,[s[3]||(s[3]=e('<li><p>修改配置文件</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">sudo</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> nano</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /etc/systemd/resolved.conf</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li>',1)),i("li",null,[s[2]||(s[2]=i("p",null,"取消注释并修改以下行",-1)),i("div",c,[i("div",o,[i("span",g,[l(n,{provider:"iconify",name:"vscode-icons:file-type-config"}),s[0]||(s[0]=a("resolved.conf",-1))])]),s[1]||(s[1]=e(`<div class="language-ini line-numbers-mode" data-highlighter="shiki" data-ext="ini" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-ini"><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#DNSStubListener=yes</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">DNSStubListener</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">no</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div>`,1))])]),s[4]||(s[4]=e('<li><p>重启 <code>systemd-resolved</code> 使配置生效</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">sudo</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> systemctl</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> restart</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> systemd-resolved</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li>',1))]),s[6]||(s[6]=e('<p><strong>方案二：关闭 <code>systemd-resolved</code> 服务</strong></p><ol><li><p>立即停止</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">sudo</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> systemctl</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> stop</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> systemd-resolved</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p>永久禁用</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">sudo</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> systemctl</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> disable</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> systemd-resolved</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li></ol>',2))]),s[11]||(s[11]=e('<h2 id="修改配置" tabindex="-1"><a class="header-anchor" href="#修改配置"><span>修改配置</span></a></h2><p>安装完成后，可配置 SmartDNS 的上游服务器信息，一般情况下，只需要增加 <code>server</code>[<code>IP</code>]<code>:port</code> 和 <code>server-tcp</code>[<code>IP</code>]<code>:port</code> 配置项，请尽可能配置多个上游 DNS 服务器，包括国内外的服务器。具体配置参数请参考<code>配置文件</code>说明</p><ul><li>配置文件</li></ul><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">vi</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /etc/smartdns/smartdns.conf</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div>',4)),i("div",u,[s[9]||(s[9]=i("p",{class:"hint-container-title"},[i("code",{class:"filepath"},"/etc/smartdns/smartdns.conf"),a(" 配置包含如下基本内容：")],-1)),i("div",m,[i("div",v,[i("span",b,[l(n,{provider:"iconify",name:"vscode-icons:file-type-config"}),s[7]||(s[7]=a("smartdns.conf",-1))])]),s[8]||(s[8]=e(`<div class="language-ini line-numbers-mode" data-highlighter="shiki" data-ext="ini" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-ini"><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 指定监听的端口号</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">bind []:53 </span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 指定上游服务器</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">server 1.1.1.1</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">server-tls 8.8.8.8</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 指定域名规则</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">address /example.com/1.2.3.4</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">domain-rules /example.com/ -address 1.2.3.4</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,1))])]),s[12]||(s[12]=e(`<h2 id="启动服务" tabindex="-1"><a class="header-anchor" href="#启动服务"><span>启动服务</span></a></h2><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">systemctl</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> enable</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> smartdns</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">systemctl</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> start</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> smartdns</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="将-dns-请求转发到-smartdns-解析" tabindex="-1"><a class="header-anchor" href="#将-dns-请求转发到-smartdns-解析"><span>将 DNS 请求转发到 SmartDNS 解析</span></a></h2><p>修改本地路由器的 DNS 服务器，将 DNS 服务器配置为 SmartDNS。</p><ul><li><p>登录到本地网络的路由器中，配置树莓派，分配其静态 IP 地址。</p></li><li><p>修改 WAN 口或者 DHCP DNS 为树莓派 IP 地址。</p></li></ul><div class="hint-container warning"><p class="hint-container-title">注意</p><ol><li>每款路由器配置方法不尽相同，请在网络上搜索对应配置方法。</li><li>华为等路由器可能不支持配置 DNS 为本地 IP，可修改电脑端或手机端的 DNS 服务器为树莓派 IP。</li></ol></div><h2 id="检测服务是否配置成功" tabindex="-1"><a class="header-anchor" href="#检测服务是否配置成功"><span>检测服务是否配置成功</span></a></h2><ul><li>执行</li></ul><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">nslookup</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -querytype=ptr</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> smartdns</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li>查看命令结果中的 <code>name</code> 是否为 <code>smartdns</code> 或你的主机名，如果是则表示生效</li></ul><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>$ nslookup -querytype=ptr smartdns</span></span>
<span class="line"><span>Server:         192.168.1.1</span></span>
<span class="line"><span>Address:        192.168.1.1#53</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Non-authoritative answer:</span></span>
<span class="line"><span>smartdns        name = smartdns.</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,11))])}const D=t(p,[["render",y]]),x=JSON.parse('{"path":"/article/gewr3ily/","title":"Linux 下安装 SmartDNS","lang":"zh-CN","frontmatter":{"title":"Linux 下安装 SmartDNS","createTime":"2025/04/29 19:50:51","permalink":"/article/gewr3ily/","tags":["dns","linux"],"copyright":{"creation":"pymumu","license":"CC-BY-4.0","source":"https://pymumu.github.io/smartdns/install/linux/","author":{"name":"pymumu","url":"https://pymumu.github.io/smartdns/"}},"description":"Linux安装 下载配套安装包，并上传到 Linux 系统中, 标准 Linux 系统（X86 / X86_64）请执行如下命令安装： 树莓派或其他 Debian 系系统（ARM / ARM64）请执行如下命令安装： 关注 Ubuntu 系统 53 端口占用问题 ubuntu系统下，systemd-resolved会占用 TCP53 和 UDP53 端...","head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Linux 下安装 SmartDNS\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2025-05-07T10:29:40.000Z\\",\\"author\\":[]}"],["meta",{"property":"og:url","content":"https://powersen.cn/article/gewr3ily/"}],["meta",{"property":"og:site_name","content":"Powersen"}],["meta",{"property":"og:title","content":"Linux 下安装 SmartDNS"}],["meta",{"property":"og:description","content":"Linux安装 下载配套安装包，并上传到 Linux 系统中, 标准 Linux 系统（X86 / X86_64）请执行如下命令安装： 树莓派或其他 Debian 系系统（ARM / ARM64）请执行如下命令安装： 关注 Ubuntu 系统 53 端口占用问题 ubuntu系统下，systemd-resolved会占用 TCP53 和 UDP53 端..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-05-07T10:29:40.000Z"}],["meta",{"property":"article:tag","content":"linux"}],["meta",{"property":"article:tag","content":"dns"}],["meta",{"property":"article:modified_time","content":"2025-05-07T10:29:40.000Z"}]]},"readingTime":{"minutes":2.11,"words":632},"git":{"createdTime":1746613780000,"updatedTime":1746613780000},"autoDesc":true,"filePathRelative":"3.软件/2.Linux/b-software-linux-1.smartdns.md","headers":[],"categoryList":[{"id":"eac9c5","sort":3,"name":"软件"},{"id":"5df0b9","sort":2,"name":"Linux"}]}');export{D as comp,x as data};
